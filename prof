#!/usr/bin/env bash

function main {
    case "$1" in
        create)
            create_profile "$2" "$3"
            ;;
        edit)
            edit_profile "$2"
            ;;
        delete)
            delete_profile "$2"
            ;;
        list)
            list_profiles
            ;;
        export)
            export_profile "$2" "$3"
            ;;
        import)
            import_profile "$2"
            ;;
        help)
            display_help
            ;;
        *)
            echo "Invalid command: $1"
            display_help
            ;;
    esac
}


function create_profile {
    if [ -z "$1" ]; then
        echo "Error: No profile name provided."
        echo "Usage: prof create <profile_name> <load_order>"
        return 1
    fi

    if [ -z "$2" ]; then
        echo "Error: No load order provided."
        echo "Usage: prof create <profile_name> <load_order>"
        return 1
    fi

    if ! [[ "$2" =~ ^[0-9]+$ ]]; then
        echo "Error: Load order must be a positive integer."
        return 1
    fi

    if ! [[ "$1" =~ ^[A-Za-z0-9_-]+$ ]]; then
        echo "Error: Profile name can only contain letters, numbers, underscores, and hyphens."
        return 1
    fi

    local profile_name=$1
    local load_order=$2

    # Ensure the ~/.bash_profiles directory exists
    mkdir -p ~/.bash_profiles

    # Ensure the profile metadata file exists
    touch ~/.bash_profiles/.profile_metadata

    # Determine the user's preferred editor
    local editor=${EDITOR:-vi}  # Default to vi if no editor is set

    # Format the load order with leading zeros
    printf -v formatted_load_order "%02d" "$load_order"

    # Check if profile already exists
    if grep -qw "$profile_name" ~/.bash_profiles/.profile_metadata; then
        echo "Profile $profile_name already exists."
        return
    fi

    # Add the profile to the metadata file
    echo "$formatted_load_order $profile_name" >> ~/.bash_profiles/.profile_metadata

    # Copy the template to the new profile file
    cp profile_template.sh ~/.bash_profiles/$profile_name

    # Open the new profile in the editor
    $editor ~/.bash_profiles/$profile_name
}


function edit_profile {
    if [ -z "$1" ]; then
        echo "Error: No profile name provided."
        echo "Usage: prof edit <profile_name>"
        return 1
    fi

    local profile_name=$1

    # Determine the user's preferred editor
    local editor=${EDITOR:-vi}  # Default to vi if no editor is set

    # Check if the profile exists
    if grep -qw "$profile_name" ~/.bash_profiles/.profile_metadata; then
        # Open the profile in the editor
        $editor ~/.bash_profiles/$profile_name
    else
        echo "Error: Profile $profile_name does not exist."
        return 1
    fi
}


function delete_profile {
    echo "Delete profile function called with profile name: $1"
    # Implement profile deletion logic here.
}

function list_profiles {
    echo "List profiles function called"
    # Implement profile listing logic here.
}

function export_profile {
    echo "Export profile function called with profile name: $1 and destination: $2"
    # Implement profile export logic here.
}

function import_profile {
    echo "Import profile function called with source: $1"
    # Implement profile import logic here.
}

function display_help {
    echo "Display help function called"
    # Implement help display logic here.
}

# Entry point of the script
main "$@"

